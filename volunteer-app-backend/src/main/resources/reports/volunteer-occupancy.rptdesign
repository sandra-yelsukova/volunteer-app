<?xml version="1.0" encoding="UTF-8"?>
<report xmlns="http://www.eclipse.org/birt/2005/design" version="3.2.22" id="1">
    <property name="createdBy">Volunteer App</property>
    <data-sources>
        <oda-data-source extensionID="org.eclipse.birt.report.data.oda.jdbc" name="VolunteerDB" id="2">
            <property name="odaDriverClass">org.postgresql.Driver</property>
            <property name="odaURL">jdbc:postgresql://localhost:5432/volunteer_db</property>
            <property name="odaUser">postgres</property>
            <property name="odaPassword">postgres</property>
        </oda-data-source>
    </data-sources>
    <data-sets>
        <oda-data-set
            extensionID="org.eclipse.birt.report.data.oda.jdbc.JdbcSelectDataSet"
            name="VolunteerOccupancy"
            id="3">
            <property name="dataSource">VolunteerDB</property>
            <list-property name="resultSet">
                <structure>
                    <property name="position">1</property>
                    <property name="name">VOLUNTEER_ID</property>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="position">2</property>
                    <property name="name">FULL_NAME</property>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="position">3</property>
                    <property name="name">PHONE</property>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="position">4</property>
                    <property name="name">TOTAL_TASKS</property>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="position">5</property>
                    <property name="name">ACTIVE_TASKS</property>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="position">6</property>
                    <property name="name">COMPLETED_TASKS</property>
                    <property name="dataType">decimal</property>
                </structure>
            </list-property>
            <xml-property name="queryText"><![CDATA[
                SELECT
                    u.id AS VOLUNTEER_ID,
                    CONCAT(u.surname, ' ', u.name, ' ', u.patronymic) AS FULL_NAME,
                    u.phone AS PHONE,
                    COUNT(t.id) AS TOTAL_TASKS,
                    COUNT(CASE WHEN t.status = 'IN_PROGRESS' THEN 1 END) AS ACTIVE_TASKS,
                    COUNT(CASE WHEN t.status = 'DONE' THEN 1 END) AS COMPLETED_TASKS
                FROM users u
                LEFT JOIN tasks t ON t.assignee_user_id = u.id
                WHERE u.role = 'VOLUNTEER'
                GROUP BY u.id, u.surname, u.name, u.patronymic, u.phone
                ORDER BY FULL_NAME
            ]]></xml-property>
        </oda-data-set>
    </data-sets>
    <body>
        <table>
            <property name="dataSet">VolunteerOccupancy</property>
            <property name="width">90%</property>
            <property name="marginLeft">auto</property>
            <property name="marginRight">auto</property>
            <list-property name="boundDataColumns">
                <structure>
                    <property name="name">VOLUNTEER_ID</property>
                    <expression name="expression" type="javascript">dataSetRow["VOLUNTEER_ID"]</expression>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="name">FULL_NAME</property>
                    <expression name="expression" type="javascript">dataSetRow["FULL_NAME"]</expression>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="name">PHONE</property>
                    <expression name="expression" type="javascript">dataSetRow["PHONE"]</expression>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="name">TOTAL_TASKS</property>
                    <expression name="expression" type="javascript">dataSetRow["TOTAL_TASKS"]</expression>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="name">ACTIVE_TASKS</property>
                    <expression name="expression" type="javascript">dataSetRow["ACTIVE_TASKS"]</expression>
                    <property name="dataType">decimal</property>
                </structure>
                <structure>
                    <property name="name">COMPLETED_TASKS</property>
                    <expression name="expression" type="javascript">dataSetRow["COMPLETED_TASKS"]</expression>
                    <property name="dataType">decimal</property>
                </structure>
            </list-property>
            <column>
                <property name="width">5%</property>
            </column>
            <column>
                <property name="width">25%</property>
            </column>
            <column>
                <property name="width">25%</property>
            </column>
            <column>
                <property name="width">15%</property>
            </column>
            <column>
                <property name="width">15%</property>
            </column>
            <column>
                <property name="width">15%</property>
            </column>
            <header>
                <row>
                    <cell>
                        <property name="textAlign">center</property>
                        <property name="borderBottomStyle">solid</property>
                        <property name="borderBottomWidth">1px</property>
                        <label><text-property name="text">ID</text-property></label>
                    </cell>
                    <cell>
                        <property name="textAlign">center</property>
                        <property name="borderBottomStyle">solid</property>
                        <property name="borderBottomWidth">1px</property>
                        <label><text-property name="text">Волонтер</text-property></label>
                    </cell>
                    <cell>
                        <property name="textAlign">center</property>
                        <property name="borderBottomStyle">solid</property>
                        <property name="borderBottomWidth">1px</property>
                        <label><text-property name="text">Телефон</text-property></label>
                    </cell>
                    <cell>
                        <property name="textAlign">center</property>
                        <property name="borderBottomStyle">solid</property>
                        <property name="borderBottomWidth">1px</property>
                        <label><text-property name="text">Всего задач</text-property></label>
                    </cell>
                    <cell>
                        <property name="textAlign">center</property>
                        <property name="borderBottomStyle">solid</property>
                        <property name="borderBottomWidth">1px</property>
                        <label><text-property name="text">Активные</text-property></label>
                    </cell>
                    <cell>
                        <property name="textAlign">center</property>
                        <property name="borderBottomStyle">solid</property>
                        <property name="borderBottomWidth">1px</property>
                        <label><text-property name="text">Завершенные</text-property></label>
                    </cell>
                </row>
            </header>
            <detail>
                <row>
                    <cell>
                        <property name="textAlign">center</property>
                        <data>
                            <property name="resultSetColumn">VOLUNTEER_ID</property>
                        </data>
                    </cell>
                    <cell>
                        <property name="textAlign">left</property>
                        <data>
                            <property name="resultSetColumn">FULL_NAME</property>
                        </data>
                    </cell>
                    <cell>
                        <property name="textAlign">center</property>
                        <data>
                            <property name="resultSetColumn">PHONE</property>
                        </data>
                    </cell>
                    <cell>
                        <property name="textAlign">center</property>
                        <data>
                            <property name="resultSetColumn">TOTAL_TASKS</property>
                        </data>
                    </cell>
                    <cell>
                        <property name="textAlign">center</property>
                        <data>
                            <property name="resultSetColumn">ACTIVE_TASKS</property>
                        </data>
                    </cell>
                    <cell>
                        <property name="textAlign">center</property>
                        <data>
                            <property name="resultSetColumn">COMPLETED_TASKS</property>
                        </data>
                    </cell>
                </row>
            </detail>
        </table>
    </body>
</report>